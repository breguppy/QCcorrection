---
title: "`r params$title %||% 'QC Correction Report'`"
output:
  html_document:
    self_contained: true
    toc: true
    toc_depth: 2
    toc_float: true
params:
  title:
    value: "QC Correction Report"
  notes:
    value: ""
  plots:
    value: !r character(0)
  include:
    value: !r character(0)
  choices:
    value: !r character(0)
  descriptions:
    value: !r character(0)
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::opts_chunk$set(dev = "svg")
statement <- function(name) {
  d <- params$descriptions[[name]]
  if (is.character(d) && nzchar(d)) knitr::asis_output(paste0(d, "\n\n"))
}
library(htmltools)
library(dplyr)
```
# Preprocessing Steps

### Raw Data Basic Information
```{r}
ui_basic_info(params$choices$raw_df, params$choices$replacement_counts)
statement("Withheld Columns")
```

### Missing Value Filter
```{r}
ui_filter_info(params$choices$filtered$mv_removed_cols, params$choices$Frule)
```

### Missing Value Imputation
```{r}
statement("Imputation Description")
```

### Correction Description
```{r}
statement("Correction Description")
```

### Post-correction Filter
```{r}
ui_postcor_filter_info(params$choices$filtered_corrected, params$choices$rsd_filter, params$choices$post_cor_filter)
```

### Transformation Description
```{r}
statement("Transformation Description")
```

# Correction Evaluation

### Visualize the Correction with Metabolite Scatter Plots

```{r, echo=FALSE, fig.show='hold', out.width='49%', fig.width=5, fig.height=5}
print(params$plots[["Metabolite Scatter 1"]])
print(params$plots[["Metabolite Scatter 2"]])
```

```{r}
statement("Metabolite Scatter Plots")
```

### RSD Comparison

```{r, echo=FALSE, fig.width=7.5, fig.height=4.5}
print(params$plots[["RSD Comparison"]])
```

To judge how well the correction method worked, we can visualize the change in variation with the relative standard deviation (RSD) comparison plots. RSD is sometimes called coefficient of variation (CV) and is computed as RSD = (standard deviation / mean) * 100%. High RSD indicates that the values for that metabolite are more spread out around the mean, which may be an expected result in the experimental samples. For QC samples, RSD should decrease after correction.
```{r}
statement("RSD Comparison")
```

### PCA Comparison

```{r, echo=FALSE, fig.width=8.333, fig.height=4.417}
print(params$plots[["PCA Comparison"]])
```

```{r}
statement("PCA Comparison")
```